---
title: "Chess Analysis Project 1"
author: "Mike Birlew"
date: "2023-02-11"
output: pdf_document
bibliography: citations.bib
---
```{r, echo=FALSE, include=FALSE, message=FALSE}
library(tidyverse)
library(ChessPack)
library(ggplot2)
library(knitr)
library(readr)
library(cowplot)
library(kableExtra)
```

$$Introduction$$
  Chess is a complex game of strategy with several factors involved that lead to a win. The raw data set comes from kaggle's website  https://www.kaggle.com/datasets/datasnaek/chess. This data set includes over 2000 games that were collected from an online chess simulator containing user data from Lichess.org. This project will begin to look into patterns that players may use to influence there chances of winning specifically move sets, known as opening moves, that have been defined as standard opening plays consisting of a specific set of moves.
  

$$Data\>Cleaning$$
  To analyze the data for move strategy comparison, the raw data has been cleaned from sixteen columns to seven columns. The winner column has been filtered of all games that are not defined as a win and standardized opening moves sets (opening_eco) has been factored to contain 272 factors. 



```{r,echo=FALSE}
# turn opening plays into factors
chess.small<- chess.small %>%
  mutate(opening_eco=factor(opening_eco))
```

```{r,echo=FALSE}
# wins vs opening moves
opening.wins <- chess.small %>% count(opening_eco, winner, sort = TRUE)%>%
  arrange(n)
```

```{r}
# plot overall wins between black and white
ggplot(opening.wins, aes(x=winner,  y= n, fill = winner)) +
  geom_col() +
  ylim(0,3500) +
  labs(x = "Winner", y = "Wins", title = "Total Wins") +
  theme(plot.title = element_text(hjust = 0.5))
```

**Figure 2.** The box plot gives a better detail of the quantiles (the minimum here is 1) and median projection not seen in **Figure 1.**. We can see more clearly that, over all, White does have a slight advantage but a majority of the games throughout are held equally. One exception is the outlier 'Black'
move set #1 (A00) Polish (Sokolsky) opening.

**Note:** One thing that I find fascinating is the correlation to particular move sets
that can give advantages to a player especially when playing as 'Black'. The dominate for black to win is move set #1 (A00) Polish (Sokolsky) opening. If I were to try and improve my game I would
study the top three opening move sets associated with the spikes of wins for 'White' and 'Black'
and use them accordingly.

(Also while going through other graphs, I clearly see the constant advantage that 'White' has overall due to always moving first. But as we had discussed earlier in class, 'Black' actually does gain an overall advantage the longer the game progresses. These are very tiny gains but they show up consistently.)
```{r, echo=FALSE}
# Dont need!!
#chess.sort <- chess.small %>%
  #mutate(sorted_eco = as.numeric(sort.int(opening_eco)))
```


```{r}
# create number of matches black/white win by play
pivot_games <- pivot_wider(opening.wins, names_from = winner, values_from = n)
```


```{r}
# creates data frame for black wins drops na
# adds total games and percent of moves to wins
black_win <- select(pivot_games, opening_eco, black) %>% drop_na() %>%
  mutate('total_games' = sum(black)) %>%
  mutate('percent_move_win'= (black/total_games)*100)
```


```{r}

# creates data frame for white wins drops na
# adds total games and percent of moves to wins
white_win <- select(pivot_games, opening_eco, white) %>% drop_na() %>%
  mutate('total_games' = sum(white)) %>%
  mutate('percent_move_win'= (white/total_games)*100)
```


```{r}
#summary_black <- c('opening_eco', 'black', 'percent_move_win')
#table_black <- summary(final_set_black[c('black', 'percent_move_win')])
#table_white <-summary(final_set_white[c('white', 'percent_move_win')])

```

```{r}
# create table for percent and game win camparison
table_black <- summary(black_win[c('black', 'percent_move_win')])
table_white <-summary(white_win[c('white', 'percent_move_win')])

```


```{r}
# knit table_black, table_white together for comparison
kables(
  list(
    # change column names for comparison
    kable(table_black, col.names = c('Black Wins', 'Percent to Win'),
          valign = 't'),
    kable(table_white, col.names = c('White Wins', 'Percent to Win'),
          valign = 't')),
  caption = 'Table 1. White/Black Win Summary (Total Games: 6325)')
```

```{r}
# categorize for black to win chance small, medium, large
categorized_black <- cut(black_win$percent_move_win, breaks = c(0, .45,.94, 9.5),
                         labels = c("small (<.45%)", "medium (.45-.9%)","large (1-9.5%)"))
```


```{r}
# categorize for white to win chance small, medium, large
categorized_white <- cut(white_win$percent_move_win, breaks = c(0, .45,.94, 5.5),
                         labels = c("small (<.45%)", "medium (.45-.9%)","large (1-5.5%)"))
```


```{r}
# create black category d.f.
final_set_black <- data.frame(black_win, categorized_black)
```


```{r}
# create white category d.f.
final_set_white <- data.frame(white_win, categorized_white)
```

```{r}
# plot black grouped wins
fig_1.1 <- ggplot(final_set_black, aes(x = categorized_black,fill = categorized_black)) +
  geom_bar() +
  labs(title = 'Chance of Black Win by Grouped Moveset', x = " ") +
  # add counts to bars
  geom_text(aes(label=..count..), stat = 'count',vjust= 1) +
  # color bars for categories
  scale_fill_brewer(palette="Set1") +
  # adjust title
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# plot white grouped wins
fig_1.2 <- ggplot(final_set_white, aes(x = categorized_white, fill = categorized_white)) +
  geom_bar() +
  labs(title = 'Chance of White Win by Grouped Moveset',x = " ") +
  # add counts to bars
  geom_text(aes(label=..count..), stat = 'count',vjust=1) +
  # color bars for categories
  scale_fill_brewer(palette="Set1") +
  # adjust title
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# combine white, black, plots
plot_grid(fig_1.1,fig_1.2,nrow = 2)
```

```{r}
# subset white d.f. top moves > .95%
most_win_white <- subset(final_set_white, percent_move_win > .95) %>%
#head(most_win_white)
```

```{r}
# subset balck d.f. top moves > .95%
most_win_black <- subset(final_set_black, percent_move_win > .95)
#head(most_win_black)
```

```{r}
# create plot for black top moves > .95%
# refactor opening_eco for display continuity
fig_2.1 <- ggplot(most_win_black,aes(fct_rev(fct_reorder(opening_eco, 
                                                                   percent_move_win)), 
                                               percent_move_win)) +
  geom_col(aes(fill = opening_eco)) +
  labs(x='Opening Play', y= '% Move Wins', 
       title = 'Opening Play Set (Black) > 1%', legend = 'Opening Play') +
  # change legend title
  guides(fill=guide_legend(title ='Opening Play')) +
  # flip coordinates for clarity
  coord_flip()
```


```{r}
# create plot for white top moves > .95%
# refactor opening_eco for display continuity
fig_2.2 <- ggplot(most_win_white,aes(fct_rev(fct_reorder(opening_eco, 
                                                                   percent_move_win)), 
                                               percent_move_win)) +
  geom_col(aes(fill = opening_eco)) +
  labs(x='Opening Play', y= '% Move Wins', 
       title = 'Opening Play Set (White) > 1%', legend = 'Opeing Play') +
  # change legend title
  guides(fill=guide_legend(title ='Opening Play')) +
  # flip coordinates for clarity
  coord_flip()
```

```{r}
# plot top moves white/black for comparison
plot_grid(fig_2.1,fig_2.2,nrow = 1)
```










**Appendix**
```{r, ref.label=knitr::all_labels(),echo=TRUE,eval=FALSE}
```



